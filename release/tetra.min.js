/*! Tetra.js v | (MIT Licence) (c) Viadeo/APVO Corp */var tns={},tetra=function(){"use strict";var a,b={env:"jQuery",enableBootnode:!1,bootnodeEvents:["click","mouseover","focus"],APPS_PATH:"/javascript/tetramvc/apps",GLOBAL_PATH:"/javascript/tetramvc",COMP_PATH:"/resource/comp",FETCH_URL:"/javascript/tetramvc/model/{name}/fetch.json",FETCH_METHOD:"GET",SAVE_URL:"/javascript/tetramvc/model/{name}/save.json",SAVE_METHOD:"POST",DEL_URL:"/javascript/tetramvc/model/{name}/delete.json",DEL_METHOD:"DELETE",RESET_URL:"/javascript/tetramvc/model/{name}/reset.json",RESET_METHOD:"PUT"},c=!1,d={},e={},f={},g=function(a,b){b?f.debug.log("module "+a+" : function "+b+" not implemented","all","error"):f.debug.log("module "+a+" not implemented","all","error")};return f.lib=a="undefined"!=typeof $?$:null,f.dep={define:function(){g("dep","define")},undef:function(){g("dep","undef")},require:function(){g("dep","require")}},f.orm=function(){return g("orm"),{type:"interface",save:function(){g("orm","save")},fetch:function(){g("orm","fetch")},del:function(){g("orm","del")},reset:function(){g("orm","reset")},notify:function(){g("orm","notify")}}},f.pipe={page:{notify:function(a,b){return f.debug.log("page : "+a,"all","log",b),tetra.controller.notify(a,b),this}},appBuilder:function(a,b){return"view"===a?{notify:function(c,d){return f.debug.log("app "+b+" : "+a+" : "+c,b,"log",d),tetra.view.notify(c,d,b),this}}:{notify:function(c,d){return f.debug.log("app "+b+" : "+a+" : "+c,b,"log",d),tetra.controller.notify(c,d,b),this},exec:function(){for(var a=[],c=0,d=arguments.length;d>c;c++)a.push(arguments[c]);return a.push(b),tetra.controller.exec.apply(this,a)}}}},e.view={register:function(){g("view","register")},destroy:function(){g("view","destroy")},notify:function(){g("view","notify")},debug:{}},e.controller={register:function(){g("controller","register")},destroy:function(){g("controller","destroy")},notify:function(){g("controller","notify")},modelNotify:function(){g("controller","modelNotify")},exec:function(){g("controller","exec")},debug:{}},e.model={register:function(){g("model","register")},destroy:function(){g("model","destroy")},debug:{}},e.debug=function(){var b={},c=function(a,c,d,e){if(c=c||"all","undefined"!=typeof window.console&&(b[c]||"all"!==c&&b.all)){e=e||"",d=d||"log";try{console[d](a,e)}catch(f){}}};return f.debug={log:function(){}},{enable:function(d){d=d||"all",b[d]=!0,window._=a,f.debug={log:c},e.debug={enable:this.enable,man:function(){return c("Tetra.js ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),c("> debug enabled"),c("> man specs > tetra.debug.man()"),c("	# View specs			> tetra.debug.view.man()"),c("	# Controller specs		> tetra.debug.controller.man()"),c("	# Model specs			> tetra.debug.model.man()"),c("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),!0},view:e.view.debug,ctrl:e.controller.debug,model:e.model.debug}}}}(),e.extend=function(){var g=function(a,e){if("conf"===a)for(var g in e)e.hasOwnProperty(g)&&(b[g]=e[g]);else c?h(a,e):(d[a]=e,f.debug.log('Module "'+a+'" defined'))},h=function(c,d){"undefined"!=typeof e[c]?(e[c]=d(b,f,a),f.debug.log('Tetra module "'+c+'" loaded')):(f[c]="lib"===c?a=d(b,f,a):d(b,f,a),f.debug.log('Extension module "'+c+'" loaded'))},i=function(){var a=arguments[0];if("undefined"!=typeof a)if("string"==typeof a)g(a,arguments[1]);else for(var b in a)a.hasOwnProperty(b)&&g(b,a[b]);return e},j=function(){c=!0;for(var a in d)d.hasOwnProperty(a)&&h(a,d[a]);d=[]};return e.start=j,i}(),e}();"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(exports=module.exports={},exports.tns=tns,exports.tetra=tetra);var requirejs,require,define;!function(global){function isFunction(a){return"[object Function]"===ostring.call(a)}function isArray(a){return"[object Array]"===ostring.call(a)}function each(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1&&(!a[c]||!b(a[c],c,a));c-=1);}}function hasProp(a,b){return hasOwn.call(a,b)}function eachProp(a,b){var c;for(c in a)if(a.hasOwnProperty(c)&&b(a[c],c))break}function mixin(a,b,c,d){return b&&eachProp(b,function(b,e){(c||!hasProp(a,e))&&(d&&"string"!=typeof b?(a[e]||(a[e]={}),mixin(a[e],b,c,d)):a[e]=b)}),a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function getGlobal(a){if(!a)return a;var b=global;return each(a.split("."),function(a){b=b[a]}),b}function makeContextModuleFunc(a,b,c){return function(){var d,e=aps.call(arguments,0);return c&&isFunction(d=e[e.length-1])&&(d.__requireJsBuild=!0),e.push(b),a.apply(null,e)}}function addRequireMethods(a,b,c){each([["toUrl"],["undef"],["defined","requireDefined"],["specified","requireSpecified"]],function(d){var e=d[1]||d[0];a[d[0]]=b?makeContextModuleFunc(b[e],c):function(){var a=contexts[defContextName];return a[e].apply(a,arguments)}})}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);return e.requireType=a,e.requireModules=d,c&&(e.originalError=c),e}function newContext(a){function b(a){var b,c;for(b=0;a[b];b+=1)if(c=a[b],"."===c)a.splice(b,1),b-=1;else if(".."===c){if(1===b&&(".."===a[2]||".."===a[0]))break;b>0&&(a.splice(b-1,2),b-=2)}}function c(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p=c&&c.split("/"),q=p,r=y.map,s=r&&r["*"];if(a&&"."===a.charAt(0)&&(c?(q=y.pkgs[c]?p=[c]:p.slice(0,p.length-1),a=q.concat(a.split("/")),b(a),f=y.pkgs[e=a[0]],a=a.join("/"),f&&a===e+"/"+f.main&&(a=e)):0===a.indexOf("./")&&(a=a.substring(2))),d&&(p||s)&&r){for(h=a.split("/"),i=h.length;i>0;i-=1){if(k=h.slice(0,i).join("/"),p)for(j=p.length;j>0;j-=1)if(g=r[p.slice(0,j).join("/")],g&&(g=g[k])){l=g,m=i;break}if(l)break;!n&&s&&s[k]&&(n=s[k],o=i)}!l&&n&&(l=n,m=o),l&&(h.splice(0,m,l),a=h.join("/"))}return a}function d(a){isBrowser&&each(scripts(),function(b){return b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===v.contextName?(b.parentNode.removeChild(b),!0):void 0})}function e(a){var b=y.paths[a];return b&&isArray(b)&&b.length>1?(d(a),b.shift(),v.undef(a),v.require([a]),!0):void 0}function f(a,b,d,e){var f,g,h,i=a?a.indexOf("!"):-1,j=null,k=b?b.name:null,l=a,m=!0,n="";return a||(m=!1,a="_@r"+(E+=1)),-1!==i&&(j=a.substring(0,i),a=a.substring(i+1,a.length)),j&&(j=c(j,k,e),g=C[j]),a&&(j?n=g&&g.normalize?g.normalize(a,function(a){return c(a,k,e)}):c(a,k,e):(n=c(a,k,e),f=v.nameToUrl(n))),h=!j||g||d?"":"_unnormalized"+(F+=1),{prefix:j,name:n,parentMap:b,unnormalized:!!h,url:f,originalName:l,isDefine:m,id:(j?j+"!"+n:n)+h}}function g(a){var b=a.id,c=z[b];return c||(c=z[b]=new v.Module(a)),c}function h(a,b,c){var d=a.id,e=z[d];!hasProp(C,d)||e&&!e.defineEmitComplete?g(a).on(b,c):"defined"===b&&c(C[d])}function i(a,b){var c=a.requireModules,d=!1;b?b(a):(each(c,function(b){var c=z[b];c&&(c.error=a,c.events.error&&(d=!0,c.emit("error",a)))}),d||req.onError(a))}function j(){globalDefQueue.length&&(apsp.apply(B,[B.length-1,0].concat(globalDefQueue)),globalDefQueue=[])}function k(a,b,c){var d=a&&a.map,e=makeContextModuleFunc(c||v.require,d,b);return addRequireMethods(e,v,d),e.isBrowser=isBrowser,e}function l(a){delete z[a],each(G,function(b,c){return b.map.id===a?(G.splice(c,1),b.defined||(v.waitCount-=1),!0):void 0})}function m(a,b,c){var d,e=a.map.id,f=a.depMaps;if(a.inited)return b[e]?a:(b[e]=!0,each(f,function(a){var e=a.id,f=z[e];if(f&&!c[e]&&f.inited&&f.enabled)return d=m(f,b,c)}),c[e]=!0,d)}function n(a,b,c){var d=a.map.id,e=a.depMaps;if(a.inited&&a.map.isDefine)return b[d]?C[d]:(b[d]=a,each(e,function(e){var f,g=e.id,h=z[g];if(!w[g]&&h){if(!h.inited||!h.enabled)return c[d]=!0,void 0;f=n(h,b,c),c[g]||a.defineDepById(g,f)}}),a.check(!0),C[d])}function o(a){a.check()}function p(){var a,b,c,f,g=1e3*y.waitSeconds,h=g&&v.startTime+g<(new Date).getTime(),j=[],k=!1,l=!0;if(!t){if(t=!0,eachProp(z,function(c){if(a=c.map,b=a.id,c.enabled&&!c.error)if(!c.inited&&h)e(b)?(f=!0,k=!0):(j.push(b),d(b));else if(!c.inited&&c.fetched&&a.isDefine&&(k=!0,!a.prefix))return l=!1}),h&&j.length)return c=makeError("timeout","Load timeout for modules: "+j,null,j),c.contextName=v.contextName,i(c);l&&(each(G,function(a){if(!a.defined){var b=m(a,{},{}),c={};b&&(n(b,c,{}),eachProp(c,o))}}),eachProp(z,o)),h&&!f||!k||!isBrowser&&!isWebWorker||x||(x=setTimeout(function(){x=0,p()},50)),t=!1}}function q(a){g(f(a[0],null,!0)).init(a[1],a[2])}function r(a,b,c,d){a.detachEvent&&!isOpera?d&&a.detachEvent(d,b):a.removeEventListener(c,b,!1)}function s(a){var b=a.currentTarget||a.srcElement;return r(b,v.onScriptLoad,"load","onreadystatechange"),r(b,v.onScriptError,"error"),{node:b,id:b&&b.getAttribute("data-requiremodule")}}var t,u,v,w,x,y={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{}},z={},A={},B=[],C={},D={},E=1,F=1,G=[];return w={require:function(a){return k(a)},exports:function(a){return a.usingExports=!0,a.map.isDefine?a.exports=C[a.map.id]={}:void 0},module:function(a){return a.module={id:a.map.id,uri:a.map.url,config:function(){return y.config&&y.config[a.map.id]||{}},exports:C[a.map.id]}}},u=function(a){this.events=A[a.id]||{},this.map=a,this.shim=y.shim[a.id],this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},u.prototype={init:function(a,b,c,d){d=d||{},this.inited||(this.factory=b,c?this.on("error",c):this.events.error&&(c=bind(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.depMaps.rjsSkipMap=a.rjsSkipMap,this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check())},defineDepById:function(a,b){var c;return each(this.depMaps,function(b,d){return b.id===a?(c=d,!0):void 0}),this.defineDep(c,b)},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0,v.startTime=(new Date).getTime();var a=this.map;return this.shim?(k(this,!0)(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()})),void 0):a.prefix?this.callPlugin():this.load()}},load:function(){var a=this.map.url;D[a]||(D[a]=!0,v.load(this.map.id,a))},check:function(a){if(this.enabled&&!this.enabling){var b,c,d=this.map.id,e=this.depExports,f=this.exports,g=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(g)){if(this.events.error)try{f=v.execCb(d,g,e,f)}catch(h){b=h}else f=v.execCb(d,g,e,f);if(this.map.isDefine&&(c=this.module,c&&void 0!==c.exports&&c.exports!==this.exports?f=c.exports:void 0===f&&this.usingExports&&(f=this.exports)),b)return b.requireMap=this.map,b.requireModules=[this.map.id],b.requireType="define",i(this.error=b)}else f=g;this.exports=f,this.map.isDefine&&!this.ignore&&(C[d]=f,req.onResourceLoad&&req.onResourceLoad(v,this.map,this.depMaps)),delete z[d],this.defined=!0,v.waitCount-=1,0===v.waitCount&&(G=[])}this.defining=!1,a||this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=f(a.prefix,null,!1,!0);h(d,"defined",bind(this,function(d){var e,j,m,n=this.map.name,o=this.map.parentMap?this.map.parentMap.name:null;return this.map.unnormalized?(d.normalize&&(n=d.normalize(n,function(a){return c(a,o,!0)})||""),j=f(a.prefix+"!"+n,this.map.parentMap,!1,!0),h(j,"defined",bind(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),m=z[j.id],m&&(this.events.error&&m.on("error",bind(this,function(a){this.emit("error",a)})),m.enable()),void 0):(e=bind(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=bind(this,function(a){this.inited=!0,this.error=a,a.requireModules=[b],eachProp(z,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&l(a.map.id)}),i(a)}),e.fromText=function(a,b){var c=useInteractive;c&&(useInteractive=!1),g(f(a)),req.exec(b),c&&(useInteractive=!0),v.completeLoad(a)},d.load(a.name,k(a.parentMap,!0,function(a,b,c){return a.rjsSkipMap=!0,v.require(a,b,c)}),e,y),void 0)})),v.enable(d,this),this.pluginMaps[d.id]=d},enable:function(){this.enabled=!0,this.waitPushed||(G.push(this),v.waitCount+=1,this.waitPushed=!0),this.enabling=!0,each(this.depMaps,bind(this,function(a,b){var c,d,e;if("string"==typeof a){if(a=f(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.depMaps.rjsSkipMap),this.depMaps[b]=a,e=w[a.id])return this.depExports[b]=e(this),void 0;this.depCount+=1,h(a,"defined",bind(this,function(a){this.defineDep(b,a),this.check()})),this.errback&&h(a,"error",this.errback)}c=a.id,d=z[c],w[c]||!d||d.enabled||v.enable(a,this)})),eachProp(this.pluginMaps,bind(this,function(a){var b=z[a.id];b&&!b.enabled&&v.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)}),"error"===a&&delete this.events[a]}},v={config:y,contextName:a,registry:z,defined:C,urlFetched:D,waitCount:0,defQueue:B,Module:u,makeModuleMap:f,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=y.pkgs,c=y.shim,d=y.paths,e=y.map;mixin(y,a,!0),y.paths=mixin(d,a.paths,!0),a.map&&(y.map=mixin(e||{},a.map,!0,!0)),a.shim&&(eachProp(a.shim,function(a,b){isArray(a)&&(a={deps:a}),a.exports&&!a.exports.__buildReady&&(a.exports=v.makeShimExports(a.exports)),c[b]=a}),y.shim=c),a.packages&&(each(a.packages,function(a){var c;a="string"==typeof a?{name:a}:a,c=a.location,b[a.name]={name:a.name,location:c||a.name,main:(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}}),y.pkgs=b),eachProp(z,function(a,b){a.inited||a.map.unnormalized||(a.map=f(b))}),(a.deps||a.callback)&&v.require(a.deps||[],a.callback)},makeShimExports:function(a){var b;return"string"==typeof a?(b=function(){return getGlobal(a)},b.exports=a,b):function(){return a.apply(global,arguments)}},requireDefined:function(a,b){return hasProp(C,f(a,b,!1,!0).id)},requireSpecified:function(a,b){return a=f(a,b,!1,!0).id,hasProp(C,a)||hasProp(z,a)},require:function(b,c,d,e){var h,k,l,m,n;if("string"==typeof b)return isFunction(c)?i(makeError("requireargs","Invalid require call"),d):req.get?req.get(v,b,c):(h=b,e=c,l=f(h,e,!1,!0),k=l.id,hasProp(C,k)?C[k]:i(makeError("notloaded",'Module name "'+k+'" has not been loaded yet for context: '+a)));for(d&&!isFunction(d)&&(e=d,d=void 0),c&&!isFunction(c)&&(e=c,c=void 0),j();B.length;){if(n=B.shift(),null===n[0])return i(makeError("mismatch","Mismatched anonymous define() module: "+n[n.length-1]));q(n)}return m=g(f(null,e)),m.init(b,c,d,{enabled:!0}),p(),v.require},undef:function(a){j();var b=f(a,null,!0),c=z[a];delete C[a],delete D[b.url],delete A[a],c&&(c.events.defined&&(A[a]=c.events),l(a))},enable:function(a){var b=z[a.id];b&&g(a).enable()},completeLoad:function(a){var b,c,d,f=y.shim[a]||{},g=f.exports&&f.exports.exports;for(j();B.length;){if(c=B.shift(),null===c[0]){if(c[0]=a,b)break;b=!0}else c[0]===a&&(b=!0);q(c)}if(d=z[a],!b&&!C[a]&&d&&!d.inited){if(!(!y.enforceDefine||g&&getGlobal(g)))return e(a)?void 0:i(makeError("nodefine","No define call for "+a,null,[a]));q([a,f.deps||[],f.exports])}p()},toUrl:function(a,b){var d=a.lastIndexOf("."),e=null;return-1!==d&&(e=a.substring(d,a.length),a=a.substring(0,d)),v.nameToUrl(c(a,b&&b.id,!0),e)},nameToUrl:function(a,b){var c,d,e,f,g,h,i,j,k;if(req.jsExtRegExp.test(a))j=a+(b||"");else{for(c=y.paths,d=y.pkgs,g=a.split("/"),h=g.length;h>0;h-=1){if(i=g.slice(0,h).join("/"),e=d[i],k=c[i]){isArray(k)&&(k=k[0]),g.splice(0,h,k);break}if(e){f=a===e.name?e.location+"/"+e.main:e.location,g.splice(0,h,f);break}}j=g.join("/"),j+=b||(/\?/.test(j)?"":".js"),j=("/"===j.charAt(0)||j.match(/^[\w\+\.\-]+:/)?"":y.baseUrl)+j}return y.urlArgs?j+((-1===j.indexOf("?")?"?":"&")+y.urlArgs):j},load:function(a,b){req.load(v,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=s(a);v.completeLoad(b.id)}},onScriptError:function(a){var b=s(a);return e(b.id)?void 0:i(makeError("scripterror","Script error",a,[b.id]))}}}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(a){return"interactive"===a.readyState?interactiveScript=a:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.0.6",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,aps=ap.slice,apsp=ap.splice,isBrowser=!("undefined"==typeof window||!navigator||!document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(a,b,c,d){var e,f,g=defContextName;return isArray(a)||"string"==typeof a||(f=a,isArray(b)?(a=b,b=c,c=d):a=[]),f&&f.context&&(g=f.context),e=contexts[g],e||(e=contexts[g]=req.s.newContext(g)),f&&e.configure(f),e.require(a,b,c)},req.config=function(a){return req(a)},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),addRequireMethods(req),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=function(a){throw a},req.load=function(a,b,c){var d,e=a&&a.config||{};return isBrowser?(d=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),d.type=e.scriptType||"text/javascript",d.charset="utf-8",d.async=!0,d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),!d.attachEvent||d.attachEvent.toString&&d.attachEvent.toString().indexOf("[native code")<0||isOpera?(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",a.onScriptError,!1)):(useInteractive=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)),d.src=c,currentlyAddingScript=d,baseElement?head.insertBefore(d,baseElement):head.appendChild(d),currentlyAddingScript=null,d):(isWebWorker&&(importScripts(c),a.completeLoad(b)),void 0)},isBrowser&&eachReverse(scripts(),function(a){return head||(head=a.parentNode),dataMain=a.getAttribute("data-main"),dataMain?(cfg.baseUrl||(src=dataMain.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath,dataMain=mainScript),dataMain=dataMain.replace(jsSuffixRegExp,""),cfg.deps=cfg.deps?cfg.deps.concat(dataMain):[dataMain],!0):void 0}),define=function(a,b,c){var d,e;"string"!=typeof a&&(c=b,b=a,a=null),isArray(b)||(c=b,b=[]),!b.length&&isFunction(c)&&c.length&&(c.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(a,c){b.push(c)}),b=(1===c.length?["require"]:["require","exports","module"]).concat(b)),useInteractive&&(d=currentlyAddingScript||getInteractiveScript(),d&&(a||(a=d.getAttribute("data-requiremodule")),e=contexts[d.getAttribute("data-requirecontext")])),(e?e.defQueue:globalDefQueue).push([a,b,c])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),function(){function a(a,b){return a.BOOTNODE_HOST?a.BOOTNODE_HOST+b:b}tetra.extend("dep",function(b){return requirejs.config({baseUrl:a(b,b.APPS_PATH),enforceDefine:!0,waitSeconds:10,urlArgs:b.jsVersion?"v="+b.jsVersion:"",paths:{g:a(b,b.GLOBAL_PATH),comp:a(b,b.COMP_PATH)}}),{define:define,undef:requirejs.undef,require:require}})}(),tetra.extend("tmpl",function(a){!function(){var b={},c=a.tmpl&&a.tmpl.left?a.tmpl.left:"{%",d=a.tmpl&&a.tmpl.right?a.tmpl.right:"%}",e=a.tmpl&&a.tmpl.right?a.tmpl.right[0]:"%",f=new RegExp("'(?=[^"+e+"]*"+d+")","g"),g=new RegExp(c+"[=-](.+?)"+d,"g");this.tmpl=function h(a,e){try{var i=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").replace(f,"	").split("'").join("\\'").split("	").join("'").replace(g,"',$1,'").split(c).join("');").split(d).join("p.push('")+"');}return p.join('');"):b[a]=b[a]||h(document.getElementById(a).innerHTML);return e?i(e):i}catch(j){return"undefined"!=typeof console&&console.error(j.message,j),""}}}();var b={},c=function(a,c,d,e){return function(f,g,h){g||(g={}),!h&&d&&(h=d);var i,j;return b[a]&&(i=h?"tmpl_"+h+"_"+f:"tmpl_"+f,j=e?e+"_"+b[a].comp[e].countid++:i+"_"+b[a].countid++,b[a].comp[j]||(b[a].count++,e&&b[a].comp[e].count++,b[a].comp[j]={id:i,data:g,count:0,countid:0,parentid:e,html:!1},h?tetra.controller.exec(f,h,g,void 0,c,a,j):tetra.controller.exec(f,g,void 0,c,a,j))),b[a]?b[a].comp[j].html:void 0}},d=function(a,c,e,f){var g="";if(0===b[a].count)b[a].countid=0,g=tmpl(b[a].id,b[a].data),b[a]&&(b[a].cbk(g),delete b[a]);else if(f){var h=b[a].comp[c];h.html===!1&&0===h.count&&(b[a].comp[c].countid=0,h.html=tmpl(h.id,h.data),b[a].count--),h.html!==!1&&(h.parentid?d(a,h.parentid,e,!0):d(a,void 0,e,!1))}};return function(a,e,f,g,h,i){var j=new Date,k=a.split("/"),l=/\W/.test(a.replace("/",""))?a:1===k.length?"tmpl_"+k[0]:"tmpl_"+k[0]+"_"+k[1];i=i||l;var m=h&&b[h].comp[i]&&b[h].comp[i].html===!1,n="";if(null===document.getElementById(l)&&!/\W/.test(l))throw new Error('the HTML template "'+l+'" is missing in the DOM.');if(h||(h=i+"_"+j.getTime(),b[h]={id:l,data:e,comp:{},count:0,countid:0,cbk:f}),e.component=c(h,g,k[0],m?i:void 0),n=tmpl(l,e),b[h]){if(m){var o=b[h].comp[i];0===o.count&&(b[h].comp[i].html=n,b[h].comp[i].parentid&&b[h].comp[b[h].comp[i].parentid].count--,b[h].count--)}d(h,i,1===k.length?k[0]:void 0,m)}}}),tetra.extend("view",function(a,b,c){"use strict";var d,e={},f={},g={},h={},i={change:["input","select"],submit:["form"],scroll:["div","textarea","ul"],select:["input"]},j={change:!0,submit:!0,select:!0},k={},l=function(a){var b=document.createElement("div");a="on"+a;var c=a in b;return c||(b.setAttribute(a,"return;"),c="function"==typeof b[a]),b=null,c},m=function(a){var d,f,g,h,i,j;for(d in k)if(k.hasOwnProperty(d))for(g in k[d])k[d].hasOwnProperty(g)&&k[d][g]&&(f=e[d],c.toggleLib&&c.toggleLib(f.has_),i=c(a.target).hasClass("cur-clickout"),j=c(a.target).parents(".cur-clickout").length>0,i||j||(h=c(g+".cur-clickout"),b.debug.log("view "+d+" : call clickout callback on "+g,f.scope,"info"),h.removeClass("cur-clickout"),f.events.user.clickout[g](a,f.has_?h:c(h[0])[0]),k[d][g]=!1))},n=function(a,d,f){var h,i=a.type,j=!1;if("click"!==i||!a.button||2!==a.button)if("focusin"===i?i="focus":"focusout"===i&&(i="blur"),f="undefined"==typeof f?!0:!1,f||b.debug.log("view : call "+i+" listener","all","info"),h=g[i],"undefined"!=typeof h&&h.length>0){for(var l,n=0,o=h.length;o>n;n++){var p,q,r,s=h[n],t=e[s];if("undefined"==typeof t.root&&"HTML"!==a.target.tagName&&a.target.parentNode&&a.target.parentNode.tagName||d.parents("#"+t.root).length>0){"click"===i&&m(a,d),p=t.events.user[i];for(var u in p)p.hasOwnProperty(u)&&(l=d,"function"!=typeof l.is||l.is(u)||"function"==typeof l.parents&&(l=l.parents(u),l=l.length>0?c(l[0]):!1),l&&("click"===i?"undefined"==typeof t.events.user.clickout||"undefined"==typeof t.events.user.clickout[u]||l.hasClass("cur-clickout")&&"undefined"!=typeof k[s]&&"undefined"!=typeof k[s][u]||(k[s]||(k[s]={}),k[s][u]||(k[s][u]=!0),l.addClass("cur-clickout")):"mouseover"===i?(c.toggleLib&&c.toggleLib(t.has_),l.hasClass("cur-mouseover")&&l.attr("cur-mouse-view")===s?l=!1:"undefined"!=typeof t.events.user.mouseout&&"undefined"!=typeof t.events.user.mouseout[u]&&l.addClass("cur-mouseover").attr("cur-mouse-view",s)):"mouseout"===i?(q=a.relatedTarget||a.toElement,r=c(q),q&&"HTML"!==q.nodeName?r.hasClass("cur-mouseover")||r.parents(".cur-mouseover").length>0?l=!1:l.removeClass("cur-mouseover").attr("cur-mouse-view",""):l.removeClass("cur-mouseover").attr("cur-mouse-view","")):"scroll"===i&&(d.is(u)||(l=!1))),l&&(d.hasClass("no-prevent")||d.parents(".no-prevent").length>0||l.is("body")||(l.is("input")||l.is("textarea"))&&("keydown"===i||"checkbox"===l.attr("type")||"radio"===l.prop("type"))||a.preventDefault(),b.debug.log("view "+s+" : call "+i+" callback on "+u,t.scope,"info"),t.has_||(l=c(l[0])[0]),c.toggleLib&&c.toggleLib(t.has_),p[u](a,l),j=!0))}}f&&!j&&x(a,d)}else f&&x(a,d)},o=function(a){if("clickout"===a)return"click";var b=!!document.addEventListener;return b||"focus"!==a?b||"blur"!==a?a:"focusout":"focusin"},p=function(a,b,d){b=o(b),"focus"===b||"blur"===b?document.addEventListener(b,d,!0):c(a).bind(b,d)},q=function(a,b,d){b=o(b),"focus"===b||"blur"===b?document.removeEventListener(b,d,!0):c(a).unbind(b,d)},r=function(a){n(a,c(a.target))},s=function(d){"clickout"===d&&(d="click"),"undefined"==typeof g[d]&&(g[d]=[],"undefined"==typeof i[d]||"undefined"!=typeof j[d]&&l(d)?p(document,d,r):a.domLoaded?t(d):c(document).ready(function(){t(d)}),b.debug.log("view : now listening "+d,"all","info"))},t=function(a,b){"undefined"==typeof b&&(b=c("body").find(i[a].join(",")));for(var d=0,e=b.length;e>d;d++)p(b[d],a,r)},u=function(a,b){"undefined"==typeof b&&(b=c("body").find(i[a].join(",")));for(var d=0,e=b.length;e>d;d++)q(b[d],a,r)},v=function(b,c){!a.domLoaded||"undefined"==typeof i[b]||"undefined"!=typeof j[b]&&l(b)||t(b,c)},w=a.bootnodeEvents,x=function(a,d){var g,h,i,j,k,l;a.type&&a.target.parentNode&&a.target.parentNode.tagName&&-1!==c.inArray(a.type.toLowerCase(),w)&&(g=d.hasClass("bootnode")?d:d.parents(".bootnode"),g.length>0&&(h=g.attr("data-view"),i=g.attr("data-comp"),k=a.type,l=c.extend({},a),l.type=k,l.preventDefault=function(){},null!=h?g.attr("data-event")===k&&"undefined"==typeof e[h]&&(a.preventDefault(),g.addClass("loading"),j=h.split("/"),b.dep.require([j[0]+"/view/"+j[1]+".ui"],function(){g.removeClass("loading"),n(l,d,!1)})):null!=i&&g.attr("data-event")===k&&"undefined"==typeof f[i]&&(f.current=i,f[i]=function(){n(l,d,!1)},g.addClass("loading"),b.dep.require(["comp/"+i],function(){g.removeClass("loading")}),b.dep.define("comp/"+i))))},y=function(){for(var a=0,b=w.length;b>a;a++)s(w[a])};d=function(a){return b.pipe.appBuilder("view",a)},d.retrieve=function(a,b){return e[a+"/"+b]},d.list=function(){var a={};for(var c in e)e.hasOwnProperty(c)&&(b.debug.log(e[c].scope+" / "+c),"undefined"==typeof a[e[c].scope]&&(a[e[c].scope]=[]),a[e[c].scope].push(c));return a},d.msg=function(a){var c=[],d=e[a].events.controller;for(var f in d)d.hasOwnProperty(f)&&(b.debug.log(f),c.push(f));return c},d.man=function(){return b.debug.log("Tetra.js ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),b.debug.log("> View specs:"),b.debug.log("        - notify app views as a controller        > tetra.debug.view(scope).notify(message, data)"),b.debug.log("        - list all views and their scope        > tetra.debug.view.list()"),b.debug.log("        - list all controller messages listened > tetra.debug.view.msg(viewName)"),b.debug.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),!0};var z=function(a){var d=a.constr.length>2;c.toggleLib&&c.toggleLib(d);var e=b.pipe.appBuilder("controller",a.scope),f=a.constr(this,e,c);return this.has_=d,this.scope=a.scope,this.root=a.root,this.events=f.events,this.methods=f.methods,this.listen=v,this},A=function(c,d){e[c]=new z(d),b.debug.log("view "+c+" : registered",e[c].scope,"info");var i;if(e[c].events.user){var j=e[c].events.user;for(i in j)j.hasOwnProperty(i)&&(s(i,c),b.debug.log("view "+c+" : listening "+i,e[c].scope,"info"),"clickout"!==i&&g[i].push(c))}if(e[c].events.window){var k=e[c].events.window;for(i in k)k.hasOwnProperty(i)&&("undefined"==typeof h[i]&&(h[i]=[]),p(window,i,k[i]),b.debug.log("view "+c+" : listening "+i,e[c].scope,"info"),h[i].push(c))}return"undefined"!=typeof e[c].methods&&"undefined"!=typeof e[c].methods.init&&(a.hasOwnProperty("disableViewInit")&&a.disableViewInit||e[c].methods.init()),f&&f.current&&(f[f.current](),delete f.current),e[c]};return"Node"!==a.env&&c(document).ready(function(){a.domLoaded=!0}),a.enableBootnode&&y(),{register:function(a,c){var d=c.scope+"/"+a;if(!a||!c)throw new Error("tetra.view.register(name, params) : name and params are both required arguments");if(!c.hasOwnProperty("scope")||!c.hasOwnProperty("constr"))throw new Error("tetra.view.register(name, params) : params must define a scope attribute and a constr method");if(e[d])return"undefined"!=typeof console&&console.warn("view "+d+" already registered"),void 0;var f=[];if("undefined"!=typeof c.use)for(var g=0,h=c.use.length;h>g;g++)f.push(c.scope+"/controller/"+c.use[g]+".ctrl");b.dep.define(c.scope+"/view/"+a+".ui",f,function(){A(d,c)}),b.dep.require([c.scope+"/view/"+a+".ui"])},destroy:function(a,c){var d,f,k,m,n=c+"/"+a;for(var o in g)if(g.hasOwnProperty(o)){for(d=g[o],f=!0,"undefined"==typeof i[o]||"undefined"!=typeof j[o]&&l(o)||(f=!1),k=0,m=d.length;m>k;k++)d[k]===n&&(f||u(o),d.splice(k,1));f||0!==g[o].length||delete g[o]}for(o in h)if(h.hasOwnProperty(o))for(d=h[o],k=0,m=d.length;m>k;k++)d[k]===n&&(q(window,o,e[n].events.window[o]),d.splice(k,1));b.dep.undef(c+"/view/"+a+".ui"),delete e[n]},notify:function(a,d,f){var g,h,i;for(var j in e)e.hasOwnProperty(j)&&(g=e[j],h=g.scope,g.events.controller&&(i=g.events.controller,h===f&&"undefined"!=typeof i&&"undefined"!=typeof i[a]&&(b.debug.log("view "+j+" : exec "+a,f,"info"),c.toggleLib&&c.toggleLib(g.has_),i[a](d,b.pipe.appBuilder("controller",f)))))},debug:d}}),tetra.extend("controller",function(a,b){"use strict";var c,d={},e={};c={page:b.pipe.page,app:function(a){return b.pipe.appBuilder("controller",a)},list:function(){var a={};for(var c in d)d.hasOwnProperty(c)&&(b.debug.log(d[c].scope+" / "+c),"undefined"==typeof a[d[c].scope]&&(a[d[c].scope]=[]),a[d[c].scope].push(c));return a},retrieve:function(a,b){var c=d[a+"/"+b];return c&&(c.actions=e[a+"/"+b]),c},msg:function(a){var c,e=[];if(d[a]&&d[a].events.view){c=d[a].events.view;for(var f in c)c.hasOwnProperty(f)&&(b.debug.log(f),e.push(f))}else b.debug.log(a+" was not found");return e},man:function(){return b.debug.log("Tetra.js ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),b.debug.log("> Controller specs:"),b.debug.log("        - notify app controllers as a view        > tetra.debug.ctrl.app(scope).notify(message, data)"),b.debug.log("        - notify all as a controller            > tetra.debug.ctrl.page.notify(message, data)"),b.debug.log("        - list all controllers with their scope    > tetra.debug.ctrl.list()"),b.debug.log("        - list all view messages listened        > tetra.debug.ctrl.msg(ctrlName)"),b.debug.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),!0}};var f=function(a,c){var d=this,f=b.pipe.appBuilder("view",c.scope),g=c.constr(d,f,b.pipe.page,b.orm(c.scope));return this.scope=c.scope,this.events=g?g.events:{},this.methods=g?g.methods:{},e[a]=g?g.actions:{},this},g=function(c,e){return d[c]=new f(c,e),b.debug.log("controller "+c+" : registered",d[c].scope,"info"),"undefined"!=typeof d[c].methods&&"undefined"!=typeof d[c].methods.init&&(a.hasOwnProperty("disableCtrlInit")&&a.disableCtrlInit||d[c].methods.init()),d[c]};return{register:function(c,e){"Node"===a.env&&(e.scope="node");var f=e.scope+"/"+c;if(!c||!e)throw new Error("tetra.controller.register(name, params) : name and params are both required arguments");
if(!e.hasOwnProperty("scope")||!e.hasOwnProperty("constr"))throw new Error("tetra.controller.register(name, params) : params must define a scope attribute and a constr method");if(d[f])return"undefined"!=typeof console&&console.warn("controller "+f+" already registered"),void 0;var h,i=[];if("undefined"!=typeof e.use)for(var j=0,k=e.use.length;k>j;j++)h=e.use[j],"g/"===h.substring(0,2)?(h=h.substring(2),i.push("g/model/"+h+".class")):i.push(e.scope+"/model/"+h+".class");b.dep.define(e.scope+"/controller/"+c+".ctrl",i,function(){g(f,e)}),b.dep.require([e.scope+"/controller/"+c+".ctrl"])},destroy:function(a,c){var e=c+"/"+a;b.dep.undef(c+"/controller/"+a+".ctrl"),delete d[e]},notify:function(a,c,e){e=e||"all";var f,g,h;for(var i in d)d.hasOwnProperty(i)&&(f=d[i],g=f.scope,("all"!==e&&f.events.view||f.events.controller)&&(h="all"!==e?f.events.view:f.events.controller,"all"!==e&&e!==g||"undefined"==typeof h||"undefined"==typeof h[a]||(b.debug.log("ctrl "+i+" : exec "+a,e,"info"),h[a](c))))},modelNotify:function(a,c,e){var f;for(var g in d)d.hasOwnProperty(g)&&(f=d[g],f.events&&"undefined"!=typeof f.events.model&&"undefined"!=typeof f.events.model[a]&&(b.debug.log("ctrl "+g+" : model "+a+" "+c,f.scope,"info"),"undefined"!=typeof f.events.model[a][c]&&f.events.model[a][c].apply(f,e)))},exec:function(a,c,d,f,g,h,i){var j;if("string"!=typeof c)i=h,h=g,g=f,f=d,d=c,c=void 0,j=a;else{var k=g+"/"+c;j=c+"/"+a}var l=function(a,c){c||(c=j),b.tmpl(c,a,f,g,h,i)},m=function(){k&&e[k]&&e[k][a]?e[k][a](d,l):l(d)};c?b.dep.require([g+"/controller/"+c+".ctrl"],m):m()},debug:c}}),tetra.extend("model",function(a,b,c){"use strict";var d,e={},f={};tetra.extend("orm",function(a,b,c){if("undefined"!=typeof b.cache)var d=b.cache;a.api?c.initApi(a.api):a.mysql&&c.initMysql(a.mysql);var g=function(a){return a=c.trim(a),a&&0!==a.length?/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")):!1},h=function(a){return function(b){"string"==typeof b&&g(b)&&(b=JSON.parse(b)),a(b)}},i=function(a,b){return function(c){var d;g(c.responseText)&&(d=JSON.parse(c.responseText)),a(c.status,d?d:{}),(401===c.status||403===c.status)&&b(c)}},j=function(){var b=[],d=!1,e=function(){!d&&b.length>0&&(j.request(b[0].src,b[0].url,b[0].options),b.shift())};return{queue:function(c,d,f){"Node"===a.env?j.request(c,d,f):(b.push({src:c,url:d,options:f}),e())},request:function(b,f,g){c.toggleLib&&c.toggleLib(!0);var k={};return d=!0,tetra.currentRequest=function(){j.queue(b,f,g),a.currentRequestCallback&&a.currentRequestCallback()},k="Node"===a.env&&a.api&&a.api.access_token?{data:{access_token:a.api.access_token}}:{processData:g.headers["Content-Type"]&&0===g.headers["Content-Type"].indexOf("application/json")?!1:!0,beforeSend:function(a){b.model.notify("call")({req:a,obj:b.obj?b.obj:{}})},complete:function(a){b.model.notify("complete")({req:a,obj:b.obj?b.obj:{}}),d=!1,e()}},"undefined"!=typeof a.authCallback&&(k.error401=a.authCallback),k.success=h(g.success),k.error=i(g.error,k.error401),"ajax"===b.model.type?c.ajax(f,c.extend(g,k)):"api"===b.model.type?c.api(f,c.extend(g,k)):"mysql"===b.model.type?c.mysql(f,c.extend(g,k)):!1}}}();return function(g){return function(h){var i=e[g+"/"+h]||e["g/"+h],k=function(c,e,j){var k=f[g+"/"+h]||f["g/"+h],l=new k;if(l.update(c,e),i.objects[l.get("ref")]=l,0!==l.get("id")&&"0020"!==l.get("id")&&(i.ids[l.get("id")]=l.get("ref"),d&&("undefined"==typeof j||"undefined"!=typeof j&&!j))){var m="NODE:"+g+"-"+h+"-id-"+l.get("id");d.set(m,c,a.cacheTimeout,function(){"Node"===a.env&&b.debug.log('ORM: SAVE: store "'+m+'"',"all","log",c)})}return b.debug.log("model "+g+"/"+h+" : object "+l.get("ref")+" created","all","info"),t("create")(l),l},l=function(c,e){var f=c.id,k=i.objects[c.ref];t("save")(k),j.queue({model:this,obj:k},x(i.req.save,c),{type:i.req.save.method,headers:i.req.save.headers,data:y(i.req.save,c),success:function(j){if(j=j||{},"string"==typeof j&&(j={status:"SUCCESS",data:{0:{html:j}}}),"FAIL"===j.status)t("alert")({type:"save",alerts:j.alerts?j.alerts:{},obj:k},j);else{if("undefined"!=typeof j.data){for(var l in j.data)break;if("undefined"!=typeof l){if((0===f||"0020"===f)&&(i.cache={},k.set("id",l),i.ids[k.get("id")]=k.get("ref"),d)){c.id=l;var m="NODE:"+g+"-"+h+"-id-"+k.get("id");d.set(m,c,a.cacheTimeout,function(){"Node"===a.env&&b.debug.log('ORM: SAVE: store "'+m+'"',"all","log",c)})}k.update(j.data[l])}}"undefined"!=typeof e?e(k,j):t("saved")(k,j)}},error:function(a,b){t("error")({type:"save",errorCode:a,errors:b.errors?b.errors:[],obj:k},b),k.revert()}})},m=function(c,e,f){t("fetch")(c);var l=c.uriParams;j.queue({model:f?f:this},x(i.req.fetch,c),{type:i.req.fetch.method,headers:i.req.fetch.headers,data:y(i.req.fetch,c),success:function(f){if(!f||f.status&&"FAIL"===f.status)c.uriParams=l,t("alert")({type:"fetch",alerts:f&&f.alerts?f.alerts:{},cond:c},f);else{var j,m=[],n=[];if(f&&i.req.fetch.headers["Content-Type"]&&-1!==i.req.fetch.headers["Content-Type"].indexOf("text/html")&&(f=f.replace(/^\s\s*/,"")),"undefined"!=typeof i.req.fetch.parser)l&&(c.uriParams=l),j=i.req.fetch.parser(f,{},c),f={data:j,count:f&&f.count?f.count:0};else if("mysql"===i.req.type){var o=0;for(j={};o<f.length;o++)j[f[o][i.req.dbTable.id]]=f[o];f={data:j}}for(var p in f.data)f.data.hasOwnProperty(p)&&(m.push(p),f.data[p].id=p,n.push(k(f.data[p])));"Node"===a.env&&delete c.access_token,c.uriParams=l;var q=JSON.stringify(c);if("Node"===a.env&&b.debug.log("ORM: FETCH "+g+"/"+h+" with cond: "+q,"all","log"),d){var r="NODE:"+g+"-"+h+"-req-"+q;d.set(r,m,a.cacheTimeout,function(){"Node"===a.env&&b.debug.log('ORM: FETCH: store "'+r+'"',"all","log",m)})}else i.cache[q]=m;if("string"!=typeof f)for(var s in f)f.hasOwnProperty(s)&&"status"!==s&&"data"!==s&&"alerts"!==s&&"errors"!==s&&(i.meta[s]=f[s]);"undefined"!=typeof e?e(n):t("append")(n)}},error:function(a,b){c.uriParams=l,t("error")({type:"fetch",errorCode:a,errors:b&&b.errors?b.errors:[],cond:c},b)}})},n=function(a,b){if("undefined"==typeof i.ids[a]){var c=this;m({id:a},b?function(a){b(a[0])}:void 0,c)}else b(i.objects[i.ids[a]])},o=function(a,b){b(i.objects[a]||null)},p=function(a,b){var c,d=[],e=i.objects;for(var f in e)if(e.hasOwnProperty(f)){c=!0;for(var g in a)if(a.hasOwnProperty(g)&&e[f].get(g)!==a[g]){c=!1;break}c&&d.push(e[f])}d.length<=1?b(d[0]||null):b(d)},q=function(c,e){if(c.uriParams){var f=c.uriParams;delete c.uriParams,c.uriParams=f}var j=JSON.stringify(c);if("Node"===a.env&&b.debug.log("ORM: SELECT "+g+"/"+h+" with cond: "+j,"all","log"),d){var k="NODE:"+g+"-"+h+"-req-"+j;d.get(k,function(d,f){"Node"===a.env&&b.debug.log('ORM: SELECT: retrieve "'+k+'"',"all","log",f),r(c,f,e,this)})}else r(c,i.cache[j],e,this)},r=function(c,e,f,j){if(e){"Node"===a.env&&b.debug.log("ORM: SELECT: data retrieved from cache:","all","log",e);var l=[],n=0,o=e.length,p=[];if(0!==o&&d){for(n=0;o>n;n++)p.push("NODE:"+g+"-"+h+"-id-"+e[n]);d.get(p,function(a,b){var c,d=[];for(c in b)b.hasOwnProperty(c)&&d.push(k(b[c],!1,!0));f?f(d):t("append")(d)})}else{for(n=0;o>n;n++)l.push(i.objects[i.ids[e[n]]]);f?f(l):t("append")(l)}}else"Node"===a.env&&b.debug.log("ORM: SELECT: data retrieved from server","all","log"),m(c,f?function(a){f(a)}:void 0,j)},s=function(c,e,f){var k=i.objects[c];t("delete")(k),"undefined"==typeof e&&(e={id:k.get("id")}),j.queue({model:this},x(i.req.del,e),{type:i.req.del.method,headers:i.req.del.headers,data:y(i.req.del,e),success:function(e){if(e=e||{},"SUCCESS"===e.status||"undefined"==typeof e.status){if("undefined"!=typeof f?f(k,e):t("deleted")(k,e),delete i.ids[k.get("id")],delete i.objects[c],d){var j="NODE:"+g+"-"+h+"-id-"+k.get("id");d.del(j,function(c,d){"Node"===a.env&&b.debug.log('ORM: DEL: delete "'+j+'"',"all","log",d)})}}else t("alert")({type:"delete",alerts:e.alerts?e.alerts:{},obj:k},e)},error:function(a,b){t("error")({type:"delete",errorCode:a,errors:b.errors?b.errors:[],obj:k},b),delete i.ids[k.get("id")],delete i.objects[c]}})},t=function(a){return function(){b.debug.log("model "+g+"/"+h+" : "+a,"all","log",arguments[0]),tetra.controller.modelNotify(h,a,arguments)}},u=function(a,b){t("reset")(i.objects),i.ids={},i.objects={},j.queue({model:this},x(i.req.reset,a),{type:i.req.reset.method,headers:i.req.reset.headers,data:y(i.req.reset,a),success:function(a){a=a||{},a.status&&"FAIL"===a.status?t("alert")({type:"reset",alerts:a.alerts?a.alerts:{}},a):"undefined"!=typeof b?b(h,a):t("resetted")(h,a)},error:function(b,c){t("error")({type:"reset",errorCode:b,errors:c.errors?c.errors:[],data:a},c)}})},v=function(){var a=0,b=i.objects;for(var c in b)b.hasOwnProperty(c)&&a++;return a},w=function(a){return i.meta[a]},x=function(a,b,c){var d,e=a.url;if("mysql"===i.req.type)return i.req.dbTable;if("undefined"!=typeof a.uriParams){for(var f=0,g=a.uriParams.length;g>f;f++)e="undefined"!=typeof b[a.uriParams[f]]?e.replace("{"+f+"}",b[a.uriParams[f]]):e.replace("{"+f+"}",b.uriParams[a.uriParams[f]]);"undefined"!=typeof b.uriParams&&delete b.uriParams}return c||(d=new Date,e+=e.indexOf("?")<0?"?ts="+d.getTime():"&ts="+d.getTime()),e},y=function(a,b){return a.headers["Content-Type"]&&0===a.headers["Content-Type"].indexOf("application/json")?JSON.stringify(c.extend(b,a.params)):c.extend(b,a.params)};return{type:i.req.type,create:function(a){return k(a,!0)},save:l,fetch:m,find:n,findByRef:o,findByCond:p,select:q,del:s,reset:u,notify:t,length:function(){return v()}(),getMeta:w}}}}),d=function(a,c){return b.orm(a)(c)},d.list=function(){var a,c=[];for(a in e)e.hasOwnProperty(a)&&(b.debug.log(a),c.push(a));return c},d.retrieve=function(a,b){return e[a+"/"+b]},d.man=function(){return b.debug.log("Tetra.js ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),b.debug.log("> Model specs:"),b.debug.log("        - retrieve an object and its ref        > tetra.debug.model(modelName).findByRef(ref)"),b.debug.log("        - notify all controllers as a model        > tetra.debug.model(modelName).notify(type)(data)"),b.debug.log("              * types : call, complete, create, fetch, append, save, saved, delete, deleted, reset, resetted, error"),b.debug.log("        - list all models                        > tetra.debug.model.list()"),b.debug.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),!0};var g=function(d,e){var f=d,g=e.scope,h=e.attr,i=e.methods;return function(){var d=c.extend({ref:0,id:0},h);a.CSRFToken&&(d.CSRFToken=a.CSRFToken);var e={};for(var j in d)d.hasOwnProperty(j)&&(e[j]=d[j]);var k=c.extend({get:function(a){return d[a]},getAll:function(){return d},set:function(a,b){return e[a]=d[a],"undefined"!=typeof d[a]&&(d[a]=b),this},update:function(a,b){if(b||m(a,this)){for(var c in a)a.hasOwnProperty(c)&&this.set(c,a[c]);return this}return{save:function(){}}},revert:function(){d=e},save:function(a,e){return m(d,this)?(b.orm(g)(f).save(c.extend(d,a),e),d.id):!1},remove:function(a,e){b.orm(g)(f).del(d.ref,c.extend(d,a),e)}},i(d)),l=function(){d.ref=(new Date).getTime()+"-"+Math.ceil(1001*Math.random()),k.ref=d.ref},m=function(a,b){var c=[];if("undefined"!=typeof k.validate){var e={};for(var g in d)d.hasOwnProperty(g)&&(e[g]="undefined"!=typeof a[g]?a[g]:d[g]);if(c=k.validate(e,c),c.length>0)return tetra.controller.modelNotify(f,"invalid",[{attr:c,obj:b}]),!1}return!0};return l(),"function"==typeof k.init&&k.init(),k}},h=function(b,d){"undefined"==typeof d.req&&(d.req={});var e=c.extend({objects:{},ids:{},cache:{},meta:{}},d);"undefined"==typeof e.req.type&&(e.req.type="ajax"),e.req.fetch=c.extend({url:a.FETCH_URL.replace("{name}",b),method:a.FETCH_METHOD,headers:{},params:{}},d.req.fetch),e.req.save=c.extend({url:a.SAVE_URL.replace("{name}",b),method:a.SAVE_METHOD,headers:{},params:{}},d.req.save),e.req.del=c.extend({url:a.DEL_URL.replace("{name}",b),method:a.DEL_METHOD,headers:{},params:{}},d.req.del),e.req.reset=c.extend({url:a.RESET_URL.replace("{name}",b),method:a.RESET_METHOD,headers:{},params:{}},d.req.reset);for(var f in e.req)if(e.req.hasOwnProperty(f)){var g=e.req[f];g.hasOwnProperty("headers")&&(g.headers["Content-type"]&&(g.headers["Content-Type"]=g.headers["Content-type"],delete g.headers["Content-type"]),g.headers["Content-Type"]&&!/charset/.test(g.headers["Content-Type"])&&(g.headers["Content-Type"]=g.headers["Content-Type"]+";charset=utf-8"),g.headers.Accept||(g.headers.Accept="*/*"))}var h=d.req.save.method.toUpperCase();if("POST"!==h&&"PUT"!==h)throw new Error('A "save" can only be performed using POST or PUT');var i=d.req.del.method.toUpperCase();if("POST"!==i&&"DELETE"!==i)throw new Error('A "delete" can only be performed using POST or DELETE');var j=d.req.reset.method.toUpperCase();if("PUT"!==j&&"POST"!==j)throw new Error('A "reset" can only be performed using PUT or POST');return e};return{register:function(c,d){d=d||{},"Node"===a.env&&(d.scope="node"),d.scope||(d.scope="g");var i=d.scope+"/"+c;if(!c)throw new Error("tetra.model.register(name, params) : Name is a required argument");return e[i]||e["g/"+c]?("undefined"!=typeof console&&console.warn("model "+i+" already registered"),void 0):(b.dep.define(d.scope+"/model/"+c+".class",function(){return e[i]=h(c,d),b.debug.log("model "+i+" : registered","all","info"),f[i]=new g(c,d),b.debug.log("model "+i+" : associated class generated","all","info"),e[i]}),b.dep.require([d.scope+"/model/"+c+".class"]),void 0)},destroy:function(a,c){c||(c="g");var d=c+"/"+a;b.dep.undef(c+"/model/"+a+".class"),delete e[d]},debug:d}}),tetra.start();