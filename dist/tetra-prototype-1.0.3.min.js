/*! Tetra.js v1.0.3 | (MIT Licence) (c) Viadeo/APVO Corp */
var tns={},tetra=function(){var e={env:"jQuery",enableBootnode:!1,bootnodeEvents:["click","mouseover","focus"],APPS_PATH:"/javascript/tetramvc/apps",GLOBAL_PATH:"/javascript/tetramvc",COMP_PATH:"/resource/comp",FETCH_URL:"/javascript/tetramvc/model/{name}/fetch.json",FETCH_METHOD:"GET",SAVE_URL:"/javascript/tetramvc/model/{name}/save.json",SAVE_METHOD:"POST",DEL_URL:"/javascript/tetramvc/model/{name}/delete.json",DEL_METHOD:"DELETE",RESET_URL:"/javascript/tetramvc/model/{name}/reset.json",RESET_METHOD:"PUT"},t,n=!1,r={},i={},s={},o=function(e,t){t?s.debug.log("module "+e+" : function "+t+" not implemented","all","error"):s.debug.log("module "+e+" not implemented","all","error")};return s.lib=t=typeof $!="undefined"?$:null,s.dep={define:function(){o("dep","define")},undef:function(){o("dep","undef")},require:function(){o("dep","require")}},s.orm=function(){return o("orm"),{type:"interface",save:function(){o("orm","save")},fetch:function(){o("orm","fetch")},del:function(){o("orm","del")},reset:function(){o("orm","reset")},notify:function(){o("orm","notify")}}},s.pipe={page:{notify:function(e,t){return s.debug.log("page : "+e,"all","log",t),tetra.controller.notify(e,t),this}},appBuilder:function(e,t){return e==="view"?{notify:function(n,r){return s.debug.log("app "+t+" : "+e+" : "+n,t,"log",r),tetra.view.notify(n,r,t),this}}:{notify:function(n,r){return s.debug.log("app "+t+" : "+e+" : "+n,t,"log",r),tetra.controller.notify(n,r,t),this},exec:function(){var e=[],n=0,r=arguments.length;for(;n<r;n++)e.push(arguments[n]);return e.push(t),tetra.controller.exec.apply(this,e)}}}},i.view={register:function(){o("view","register")},destroy:function(){o("view","destroy")},notify:function(){o("view","notify")},debug:{}},i.controller={register:function(){o("controller","register")},destroy:function(){o("controller","destroy")},notify:function(){o("controller","notify")},modelNotify:function(){o("controller","modelNotify")},exec:function(){o("controller","exec")},debug:{}},i.model={register:function(){o("model","register")},destroy:function(){o("model","destroy")},debug:{}},i.debug=function(){var e={},n=function(t,n,r,i){n=n||"all";if(typeof window.console!="undefined"&&(e[n]||n!=="all"&&e.all)){i=i||"",r=r||"log";try{console[r](t,i)}catch(s){}}};return s.debug={log:function(){}},{enable:function(r){r=r||"all",e[r]=!0,window._=t,s.debug={log:n},i.debug={enable:this.enable,man:function(){return n("Tetra.js ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),n("> debug enabled"),n("> man specs > tetra.debug.man()"),n("	# View specs			> tetra.debug.view.man()"),n("	# Controller specs		> tetra.debug.controller.man()"),n("	# Model specs			> tetra.debug.model.man()"),n("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),!0},view:i.view.debug,ctrl:i.controller.debug,model:i.model.debug}}}}(),i.extend=function(){var o=function(t,i){if(t==="conf")for(var o in i)e[o]=i[o];else n?u(t,i):(r[t]=i,s.debug.log('Module "'+t+'" defined'))},u=function(n,r){typeof i[n]!="undefined"?(i[n]=r(e,s,t),s.debug.log('Tetra module "'+n+'" loaded')):(n==="lib"?s[n]=t=r(e,s,t):s[n]=r(e,s,t),s.debug.log('Extension module "'+n+'" loaded'))},a=function(){if(typeof arguments[0]!="undefined")if(typeof arguments[0]=="string")o(arguments[0],arguments[1]);else for(var e in arguments[0])o(e,arguments[0][e]);return i},f=function(){n=!0;for(var e in r)u(e,r[e]);r=[]};return i.start=f,a}(),i}();typeof module!="undefined"&&typeof module.exports!="undefined"&&(exports=module.exports={},exports.tns=tns,exports.tetra=tetra),function(){if(typeof jQuery!="undefined"){var e=function(e){return e=$.trim(e),!e||e.length===0?!1:/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))},t=!1;tns.libs||(tns.libs=[]),tns.libs.push(function(e){return{name:"jQuery",s:e,elm:function(t){return e(t)},serialize:function(t){var n="",r={},i,s;return t?(e.each(e(this).serializeArray(),function(t,n){i=n.name,s=n.value,r[i]=r[i]===undefined?s:e.isArray(r[i])?r[i].concat(s):[r[i],s]}),r):(n=e(this).serialize(),n)},ajax:function(t,n){var r=n.data,i={},s;if(n.type==="delete"||n.type==="put")n.headers["X-HTTP-Method-Override"]=n.type,n.data._method=n.type,n.type="post";if(!n.headers["Content-Type"]||n.headers["Content-Type"].indexOf("application/x-www-form-urlencoded")===1)for(s in r){if(!r.hasOwnProperty(s)||r[s]===null)continue;if(typeof r[s]!="object"||r[s].splice)i[s]=r[s]}else i=r;e.ajax({url:t,type:n.type,headers:n.headers,data:i,traditional:!0,processData:n.processData,create:n.create,complete:n.complete,success:n.success,error:n.error})},initApi:function(e){VD.init(e),t=!0},api:function(e,n){if(!t)return n.error(500,{errors:["API client not initialized"]}),!1;VD.api(e,n.type,n.data,function(e){n.success(e)})},mysql:function(e,t){t.error(500,{errors:["not implemented"]})},extend:e.extend,inArray:e.inArray,toJSON:JSON.stringify,parseJSON:e.parseJSON,trim:e.trim}}(jQuery))}}(),function(){if(typeof Prototype!="undefined"){delete Array.prototype.toJSON;function e(e){return e.replace(/\-[a-z]/g,function(e){return e.toUpperCase().replace("-","")})}function t(e,t){for(var n=0,r=this.length;n<r;n++){var i=typeof e=="string"?e:$(e).clone(),s=this[n];s.insert||(s=$(s));if(t){var o={};o[t]=i,s.insert(o)}else s.insert(i)}return this}function n(e,t){if(!this||!this.splice&&!this[e]||this.length===0||this.splice&&!this[0][e])return!1;if(this.splice){for(var n=0,r=this.length;n<r;n++)if(this[n][e].apply(this[n],t))return!0;return!1}return this[e].apply(this,t)}function r(e,t){if(!this||!this.splice&&!this[e]||this.length===0||this.splice&&!this[0][e])return this;if(this.splice){for(var n=0,r=this.length;n<r;n++){var i=Element.extend(this[n]);i[e].apply(i,t)}return this}return this[e].apply(this,t)}var i=!1;tns.libs||(tns.libs=[]),tns.libs.push({name:"Prototype",s:$,elm:function(e){return Element.extend(e)},hasClass:function(){return n.call(this,"hasClassName",arguments)},addClass:function(){return r.call(this,"addClassName",arguments)},removeClass:function(){return r.call(this,"removeClassName",arguments)},attr:function(e,t){return this&&!this.splice?typeof t=="undefined"?this.getAttribute(e):(this.setAttribute(e,t),this):null},parents:function(e){var t=this&&!this.splice&&this.ancestors?this.ancestors():[];if(e)for(var n=0,r=t.length;n<r;)t[n].match(e)?n++:(t.splice(n,1),r--);return t},find:function(){return r.call(this,"select",arguments)},is:function(){return n.call(this,"match",arguments)},val:function(e){return typeof e=="undefined"?this.value:(this.value=e,this)},html:function(e){return typeof e=="undefined"?this.innerHTML:(this.innerHTML=e,this)},serialize:function(e){return this.serialize(e)},siblings:function(){return r.call(this,"siblings",arguments)},prev:function(){return r.call(this,"previous",arguments)},next:function(){return r.call(this,"next",arguments)},append:function(e){return t.call(this,e)},prepend:function(e){return t.call(this,e,"top")},before:function(e){if(this&&this.length>0)return t.call(this,e,"before");var n=document.createElement("div");return n.innerHTML=e,n.childNodes},after:function(e){if(this&&this.length>0)return t.call(this,e,"after");var n=document.createElement("div");return n.innerHTML=e,n.childNodes},replaceWith:function(e){for(var t=0,n=this.length;t<n;t++)this[t].replace(e);return this},css:function(){var t={};if(typeof arguments[0]=="string"){if(arguments.length===1)return this.getStyle(arguments[0]);arguments.length===2&&(t[e(arguments[0])]=arguments[1])}if(typeof arguments[0]=="object")for(var n in arguments[0])t[e(n)]=arguments[0][n];return t.hasOwnProperty("float")&&(t.cssFloat=t["float"],delete t["float"]),this.setStyle(t),this},height:function(){return this.getHeight()},width:function(){return this.getWidth()},offset:function(e){return this.cumulativeOffset(e)},remove:function(){for(var e=0,t=this.length;e<t;e++)this[e].remove();return this},animate:function(){var e=arguments,t=e[0],n=400,r="swing",i;e[1]&&(typeof e[1]=="object"?(e[1].duration&&(n=e[1].duration),e[1].easing&&(r=e[1].easing),e[1].complete&&(i=e[1].complete)):(n=e[1],e[2]&&(r=e[2]),e[3]&&(i=e[3])))},ready:function(e){Event.observe(document,"dom:loaded",e)},bind:function(e,t){if(this.splice)for(var n=0,r=this.length;n<r;n++)Event.observe(this[n],e,t);else Event.observe(this,e,t)},unbind:function(e,t){if(e==="ready"){Event.stopObserving(document,"dom:loaded",t);return}if(this.splice)for(var n=0,r=this.length;n<r;n++)Event.stopObserving(this[n],e,t);else Event.stopObserving(this,e,t)},ajax:function(e,t){if(t.type==="delete"||t.type==="put")t.headers["X-HTTP-Method-Override"]=t.type;new Ajax.Request(e,{method:t.type,requestHeaders:t.headers,parameters:t.data,postBody:t.processData?"":t.data,onCreate:t.create,onComplete:t.complete,onSuccess:function(e){var n=e.responseText;e.responseJSON&&(n=e.responseJSON),t.success(n)},onFailure:t.error})},initApi:function(e){VD.init(e),i=!0},api:function(e,t){if(!i)return t.error(500,{errors:["API client not initialized"]}),!1;VD.api(e,t.type,t.data,function(e){t.success(e)})},mysql:function(e,t){t.error(500,{errors:["not implemented"]})},extend:function(e,t){return e?Object.extend(e,t):t},inArray:function(e,t){return t?t.indexOf(e):-1},toJSON:Object.toJSON,parseJSON:function(e){return e.evalJSON()},trim:function(e){return e?e.strip():""}})}}(),tetra.extend("lib",function(e,t,n){return function(t){var r=["attr","is","val","html","serialize","css","height","width","offset"],i=["hasClass","addClass","removeClass","append","prepend","before","after","replaceWith","remove","animate","bind","unbind","ready"],s=["parents","find","siblings","prev","next"],o=["elm","ajax","initApi","api","initMysql","mysql","extend","toJSON","parseJSON","inArray","trim","render","send","jsonSend"],u={},a=function(e,t,n,r){return typeof r!="undefined"&&(e[n]=function(){return r.apply(t,arguments)}),e},f=function(e,t,r,i){return typeof i!="undefined"&&(e[r]=function(){return n(i.apply(t,arguments))}),e},l=function(e,t,n){return e[t]=n,e},c=0,h=e.env,p=!1,d=t.length,v={},m={},g;for(;c<d;c++){g=t[c],v[g.name]=g;var y=function(e){var t=g.elm([]),n=t,o={};e&&typeof e!="undefined"&&(typeof e=="string"?t=Sizzle(e):e.splice?t=e:t=[e],t=g.elm(t),t.length>0&&(n=t[0],g.name==="Prototype"&&!n.hasClassName&&(n=g.elm(n))));var u;for(var l=0,c=r.length;l<c;l++)u=typeof g[r[l]]=="string"?n[g[r[l]]]:g[r[l]],a(o,n,r[l],u);c=i.length;for(var h=0;h<c;h++)u=typeof g[i[h]]=="string"?t[g[i[h]]]:g[i[h]],a(o,t,i[h],u);c=s.length;for(var p=0;p<c;p++)u=typeof g[s[p]]=="string"?n[g[s[p]]]:g[s[p]],f(o,n,s[p],u);return t=g.extend(t,o),t};for(var b=0,w=o.length;b<w;b++){var E=g[o[b]];l(u,o[b],E)}var S=function(e){if(e==="clickout")return"click";var t=!!document.addEventListener;return!t&&e==="focus"?"focusin":!t&&e==="blur"?"focusout":e};u.toggleLib=function(e){x(e),g=p},m[g.name]=g.extend(y,u)}var x=function(e){var r=h;e||(r="Prototype");if(!p||r!==p.name)p=v[r]?v[r]:t[0],n=m[p.name];return n};return x()}(tns.libs)}),tetra.extend("dep",function(e,t,n){return requirejs.config({baseUrl:e.APPS_PATH,enforceDefine:!0,urlArgs:e.jsVersion?"v="+e.jsVersion:"",paths:{g:e.GLOBAL_PATH,comp:e.COMP_PATH}}),{define:define,undef:requirejs.undef,require:require}}),tetra.extend("tmpl",function(e,t,n){(function(){var t={},n=e.tmpl&&e.tmpl.left?e.tmpl.left:"{%",r=e.tmpl&&e.tmpl.right?e.tmpl.right:"%}",i=e.tmpl&&e.tmpl.right?e.tmpl.right[0]:"%",s=new RegExp("'(?=[^"+i+"]*"+r+")","g"),o=new RegExp(n+"[=-](.+?)"+r,"g");this.tmpl=function u(e,i,a){try{var f=/\W/.test(e)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").replace(s,"	").split("'").join("\\'").split("	").join("'").replace(o,"',$1,'").split(n).join("');").split(r).join("p.push('")+"');}return p.join('');"):t[e]=t[e]||u(document.getElementById(e).innerHTML);return i?f(i):f}catch(l){return typeof console!="undefined"&&console.error(l.message,l),""}}})();var r={},i=function(e,t,n,i){return function(s,o,u){o||(o={}),!u&&n&&(u=n);if(r[e]){var a=u?"tmpl_"+u+"_"+s:"tmpl_"+s,f=i?i+"_"+r[e].comp[i].countid++:a+"_"+r[e].countid++;r[e].comp[f]||(r[e].count++,i&&r[e].comp[i].count++,r[e].comp[f]={id:a,data:o,count:0,countid:0,parentid:i,html:!1},u?tetra.controller.exec(s,u,o,undefined,t,e,f):tetra.controller.exec(s,o,undefined,t,e,f))}if(r[e])return r[e].comp[f].html}},s=function(e,t,n,i){var o="";if(r[e].count==0)r[e].countid=0,o=tmpl(r[e].id,r[e].data),r[e]&&(r[e].cbk(o),delete r[e]);else if(i){var u=r[e].comp[t];u.html===!1&&u.count==0&&(r[e].comp[t].countid=0,u.html=tmpl(u.id,u.data),r[e].count--),u.html!==!1&&(u.parentid?s(e,u.parentid,n,!0):s(e,undefined,n,!1))}};return function(e,t,n,o,u,a){var f=new Date,l=e.split("/"),c=/\W/.test(e.replace("/",""))?e:l.length==1?"tmpl_"+l[0]:"tmpl_"+l[0]+"_"+l[1],a=a?a:c,h=u&&r[u].comp[a]&&r[u].comp[a].html===!1,p="";if(document.getElementById(c)===null&&!/\W/.test(c))throw new Error("the HTML template '"+c+"' is missing in the DOM.");u||(u=a+"_"+f.getTime(),r[u]={id:c,data:t,comp:{},count:0,countid:0,cbk:n}),t.component=i(u,o,l[0],h?a:undefined),p=tmpl(c,t);if(r[u]){if(h){var d=r[u].comp[a];d.count==0&&(r[u].comp[a].html=p,r[u].comp[a].parentid&&r[u].comp[r[u].comp[a].parentid].count--,r[u].count--)}s(u,a,l.length==1?l[0]:undefined,h)}}}),tetra.extend("view",function(e,t,n){var r={},i={},s,o={},u={},a={change:["input","select"],submit:["form"],scroll:["div","textarea","ul"],select:["input"]},f={change:!0,submit:!0,select:!0},l={},c={},h=function(e){var t=document.createElement("div");e="on"+e;var n=e in t;return n||(t.setAttribute(e,"return;"),n=typeof t[e]=="function"),t=null,n},p=function(e,i){var s,o,u,a,f,l;for(s in c)for(u in c[s])c[s][u]&&(o=r[s],n.toggleLib&&n.toggleLib(o.has_),f=n(e.target).hasClass("cur-clickout"),l=n(e.target).parents(".cur-clickout").length>0,!f&&!l&&(a=n(u+".cur-clickout"),t.debug.log("view "+s+" : call clickout callback on "+u,o.scope,"info"),a.removeClass("cur-clickout"),o.events.user.clickout[u](e,o.has_?a:n(a[0])[0])),c[s][u]=!1)},d=function(e,i,s){var u=e.type,a=!1,f;if(u==="click"&&e.button&&e.button===2)return;u==="focusin"?u="focus":u==="focusout"&&(u="blur"),s=typeof s=="undefined"?!0:!1,s||t.debug.log("view : call "+u+" listener","all","info"),f=o[u];if(typeof f!="undefined"&&f.length>0){var l=function(){},h,d,v;for(var m=0,g=f.length;m<g;m++){var y=f[m],b=r[y],w,E=!1,S,x;if(typeof b.root=="undefined"&&e.target.tagName!=="HTML"&&e.target.parentNode&&e.target.parentNode.tagName||i.parents("#"+b.root).length>0){u==="click"&&p(e,i),w=b.events.user[u];for(var N in w)w.hasOwnProperty(N)&&(h=i,typeof h.is=="function"&&!h.is(N)&&typeof h.parents=="function"&&(h=h.parents(N),h=h.length>0?n(h[0]):!1),h&&(u==="click"?typeof b.events.user.clickout!="undefined"&&typeof b.events.user.clickout[N]!="undefined"&&(!h.hasClass("cur-clickout")||typeof c[y]=="undefined"||typeof c[y][N]=="undefined")&&(c[y]||(c[y]={}),c[y][N]||(c[y][N]=!0),h.addClass("cur-clickout")):u==="mouseover"?(n.toggleLib&&n.toggleLib(b.has_),h.hasClass("cur-mouseover")&&h.hasClass("cur-mouse-"+y.replace("/","-"))?h=!1:typeof b.events.user.mouseout!="undefined"&&typeof b.events.user.mouseout[N]!="undefined"&&h.addClass("cur-mouseover").addClass("cur-mouse-"+y.replace("/","-"))):u==="mouseout"?(S=e.relatedTarget||e.toElement,x=n(S),S&&S.nodeName!=="HTML"&&(x.hasClass("cur-mouseover")||x.parents(".cur-mouseover").length>0?h=!1:h.removeClass("cur-mouseover").removeClass("cur-mouse-"+y.replace("/","-")))):u==="scroll"&&(i.is(N)||(h=!1))),h&&(i.hasClass("no-prevent")||i.parents(".no-prevent").length>0||h.is("body")||(h.is("input")||h.is("textarea"))&&(u==="keydown"||h.attr("type")==="checkbox"||h.attr("type")==="radio")||e.preventDefault(),t.debug.log("view "+y+" : call "+u+" callback on "+N,b.scope,"info"),b.has_||(h=n(h[0])[0]),n.toggleLib&&n.toggleLib(b.has_),w[N](e,h),a=!0))}}s&&!a&&T(e,i)}else s&&T(e,i)},v=function(e){if(e==="clickout")return"click";var t=!!document.addEventListener;return!t&&e==="focus"?"focusin":!t&&e==="blur"?"focusout":e},m=function(e,t,r){t=v(t),t==="focus"||t==="blur"?document.addEventListener(t,r,!0):n(e).bind(t,r)},g=function(e,t,r){t=v(t),t==="focus"||t==="blur"?document.removeEventListener(t,r,!0):n(e).unbind(t,r)},y=function(e){d(e,n(e.target))},b=function(r){r==="clickout"&&(r="click"),typeof o[r]=="undefined"&&(o[r]=[],typeof a[r]=="undefined"||typeof f[r]!="undefined"&&!!h(r)?m(document,r,y):e.domLoaded?w(r):n(document).ready(function(){w(r)}),t.debug.log("view : now listening "+r,"all","info"))},w=function(e,t){typeof t=="undefined"&&(t=n("body").find(a[e].join(",")));for(var r=0,i=t.length;r<i;r++)m(t[r],e,y)},E=function(e,t){typeof t=="undefined"&&(t=n("body").find(a[e].join(",")));for(var r=0,i=t.length;r<i;r++)g(t[r],e,y)},S=function(t,n){e.domLoaded&&typeof a[t]!="undefined"&&(typeof f[t]=="undefined"||!h(t))&&w(t,n)},x=e.bootnodeEvents,T=function(e,s){var o,u,a,f,l,c;e.type&&e.target.parentNode&&e.target.parentNode.tagName&&n.inArray(e.type.toLowerCase(),x)!==-1&&(o=s.hasClass("bootnode")?s:s.parents(".bootnode"),o.length>0&&(u=o.attr("data-view"),a=o.attr("data-comp"),l=e.type,c=n.extend({},e),c.type=l,c.preventDefault=function(){},typeof u!="undefined"?o.attr("data-event")===l&&typeof r[u]=="undefined"&&(e.preventDefault(),o.addClass("loading"),f=u.split("/"),t.dep.require([f[0]+"/view/"+f[1]+".ui"],function(){o.removeClass("loading"),d(c,s,!1)})):typeof a!="undefined"&&o.attr("data-event")===l&&typeof i[a]=="undefined"&&(i[a]=!0,o.addClass("loading"),t.dep.require(["comp/"+a],function(){o.removeClass("loading"),d(c,s,!1)}))))},N=function(){for(var e=0,t=x.length;e<t;e++)b(x[e])};s=function(e){return t.pipe.appBuilder("view",e)},s.retrieve=function(e,t){return r[e+"/"+t]},s.list=function(){var e={};for(var n in r)r.hasOwnProperty(n)&&(t.debug.log(r[n].scope+" / "+n),typeof e[r[n].scope]=="undefined"&&(e[r[n].scope]=[]),e[r[n].scope].push(n));return e},s.msg=function(e){var n=[],i=r[e].events.controller;for(var s in i)i.hasOwnProperty(s)&&(t.debug.log(s),n.push(s));return n},s.man=function(){return t.debug.log("Tetra.js ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),t.debug.log("> View specs:"),t.debug.log("		- notify app views as a controller		> tetra.debug.view(scope).notify(message, data)"),t.debug.log("		- list all views and their scope		> tetra.debug.view.list()"),t.debug.log("		- list all controller messages listened > tetra.debug.view.msg(viewName)"),t.debug.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),!0};var C=function(e){var r=this,i=e.constr.length>2;n.toggleLib&&n.toggleLib(i);var s=t.pipe.appBuilder("controller",e.scope),o=e.constr(this,s,n);return this.has_=i,this.scope=e.scope,this.root=e.root,this.events=o.events,this.methods=o.methods,this.listen=S,this},k=function(n,i){r[n]=new C(i),t.debug.log("view "+n+" : registered",r[n].scope,"info");var s;if(r[n].events.user){var a=r[n].events.user;for(s in a)a.hasOwnProperty(s)&&(b(s,n),t.debug.log("view "+n+" : listening "+s,r[n].scope,"info"),s!=="clickout"&&o[s].push(n))}if(r[n].events.window){var f=r[n].events.window;for(s in f)f.hasOwnProperty(s)&&(typeof u[s]=="undefined"&&(u[s]=[]),m(window,s,f[s]),t.debug.log("view "+n+" : listening "+s,r[n].scope,"info"),u[s].push(n))}return typeof r[n].methods!="undefined"&&typeof r[n].methods.init!="undefined"&&(!e.hasOwnProperty("disableViewInit")||!e.disableViewInit)&&r[n].methods.init(),r[n]};return e.env!=="Node"&&n(document).ready(function(){e.domLoaded=!0}),e.enableBootnode&&N(),{register:function(e,n){var i=n.scope+"/"+e;if(!e||!n)throw new Error("tetra.view.register(name, params) : name and params are both required arguments");if(!n.hasOwnProperty("scope")||!n.hasOwnProperty("constr"))throw new Error("tetra.view.register(name, params) : params must define a scope attribute and a constr method");if(r[i])throw new Error("A view with the scope/name "+i+" already exists");var s=[];if(typeof n.use!="undefined")for(var o=0,u=n.use.length;o<u;o++)s.push(n.scope+"/controller/"+n.use[o]+".ctrl");t.dep.define(n.scope+"/view/"+e+".ui",s,function(e){k(i,n)}),t.dep.require([n.scope+"/view/"+e+".ui"])},destroy:function(e,n){var i=n+"/"+e,s,l,c,p;for(var d in o)if(o.hasOwnProperty(d)){s=o[d],l=!0,typeof a[d]!="undefined"&&(typeof f[d]=="undefined"||!h(d))&&(l=!1);for(c=0,p=s.length;c<p;c++)s[c]===i&&(l||E(d),s.splice(c,1));!l&&o[d].length===0&&delete o[d]}for(d in u)if(u.hasOwnProperty(d)){s=u[d];for(c=0,p=s.length;c<p;c++)s[c]===i&&(g(window,d,r[i].events.window[d]),s.splice(c,1))}t.dep.undef(n+"/view/"+e+".ui"),delete r[i]},notify:function(e,i,s){var o,u,a;for(var f in r)r.hasOwnProperty(f)&&(o=r[f],u=o.scope,o.events.controller&&(a=o.events.controller,u===s&&typeof a!="undefined"&&typeof a[e]!="undefined"&&(t.debug.log("view "+f+" : exec "+e,s,"info"),n.toggleLib&&n.toggleLib(o.has_),a[e](i,t.pipe.appBuilder("controller",s)))))},debug:s}}),tetra.extend("controller",function(e,t,n){var r={},i={},s;s={page:t.pipe.page,app:function(e){return t.pipe.appBuilder("controller",e)},list:function(){var e={};for(var n in r)r.hasOwnProperty(n)&&(t.debug.log(r[n].scope+" / "+n),typeof e[r[n].scope]=="undefined"&&(e[r[n].scope]=[]),e[r[n].scope].push(n));return e},retrieve:function(e,t){var n=r[e+"/"+t];return n&&(n.actions=i[e+"/"+t]),n},msg:function(e){var n=[],i;if(r[e]&&r[e].events.view){i=r[e].events.view;for(var s in i)i.hasOwnProperty(s)&&(t.debug.log(s),n.push(s))}else t.debug.log(e+" was not found");return n},man:function(){return t.debug.log("Tetra.js ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),t.debug.log("> Controller specs:"),t.debug.log("		- notify app controllers as a view		> tetra.debug.ctrl.app(scope).notify(message, data)"),t.debug.log("		- notify all as a controller			> tetra.debug.ctrl.page.notify(message, data)"),t.debug.log("		- list all controllers with their scope	> tetra.debug.ctrl.list()"),t.debug.log("		- list all view messages listened		> tetra.debug.ctrl.msg(ctrlName)"),t.debug.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),!0}};var o=function(e,n){var r=this,s=t.pipe.appBuilder("view",n.scope),o=n.constr(r,s,t.pipe.page,t.orm(n.scope));return this.scope=n.scope,this.events=o.events,this.methods=o.methods,i[e]=o.actions,this},u=function(e,n){return r[e]=new o(e,n),t.debug.log("controller "+e+" : registered",r[e].scope,"info"),typeof r[e].methods!="undefined"&&typeof r[e].methods.init!="undefined"&&r[e].methods.init(),r[e]};return{register:function(n,i){e.env==="Node"&&(i.scope="node");var s=i.scope+"/"+n;if(!n||!i)throw new Error("tetra.controller.register(name, params) : name and params are both required arguments");if(!i.hasOwnProperty("scope")||!i.hasOwnProperty("constr"))throw new Error("tetra.controller.register(name, params) : params must define a scope attribute and a constr method");if(r[s])throw new Error("A controller with the scope/name "+s+" already exists");var o=[],a;if(typeof i.use!="undefined")for(var f=0,l=i.use.length;f<l;f++)a=i.use[f],a.substring(0,2)==="g/"?(a=a.substring(2),o.push("g/model/"+a+".class")):o.push(i.scope+"/model/"+a+".class");t.dep.define(i.scope+"/controller/"+n+".ctrl",o,function(){u(s,i)}),t.dep.require([i.scope+"/controller/"+n+".ctrl"])},destroy:function(e,n){var i=n+"/"+e;t.dep.undef(n+"/controller/"+e+".ctrl"),delete r[i]},notify:function(e,n,i){i=i||"all";var s,o,u;for(var a in r)if(r.hasOwnProperty(a)){s=r[a],o=s.scope;if(i!=="all"&&s.events.view||s.events.controller)u=i!=="all"?s.events.view:s.events.controller,(i==="all"||i===o)&&typeof u[e]!="undefined"&&(t.debug.log("ctrl "+a+" : exec "+e,i,"info"),u[e](n))}},modelNotify:function(e,n,i){var s;for(var o in r)r.hasOwnProperty(o)&&(s=r[o],s.events&&typeof s.events.model!="undefined"&&typeof s.events.model[e]!="undefined"&&(t.debug.log("ctrl "+o+" : model "+e+" "+n,s.scope,"info"),typeof s.events.model[e][n]!="undefined"&&s.events.model[e][n].apply(s,i)))},exec:function(e,n,r,s,o,u,a){var f;if(typeof n!="string")a=u,u=o,o=s,s=r,r=n,n=undefined,f=e;else{var l=o+"/"+n;f=n+"/"+e}var c=function(e,n){n||(n=f),t.tmpl(n,e,s,o,u,a)},h=function(){l&&i[l]&&i[l][e]?i[l][e](r,c):c(r)};n?t.dep.require([o+"/controller/"+n+".ctrl"],h):h()},debug:s}}),tetra.extend("model",function(e,t,n){var r={},i={},s;tetra.extend("orm",function(e,t,n){if(typeof t.cache!="undefined")var s=t.cache;e.api?n.initApi(e.api):e.mysql&&n.initMysql(e.mysql);var o=function(e){return e=n.trim(e),!e||e.length===0?!1:/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))},u=function(e){return function(t){typeof t=="string"&&o(t)&&(t=JSON.parse(t)),e(t)}},a=function(e,t){return function(n){var r;o(n.responseText)&&(r=JSON.parse(n.responseText)),e(n.status,r?r:{}),(n.status===401||n.status===403)&&t(n)}},f=function(){var t=[],r=!1,i=function(){!r&&t.length>0&&(f.request(t[0].src,t[0].url,t[0].options),t.shift())};return{queue:function(n,r,s){e.env==="Node"?f.request(n,r,s):(t.push({src:n,url:r,options:s}),i())},request:function(t,s,o){n.toggleLib&&n.toggleLib(!0);var l={};return r=!0,tetra.currentRequest=function(){f.queue(t,s,o),e.currentRequestCallback&&e.currentRequestCallback()},e.env==="Node"&&e.api&&e.api.access_token?l={data:{access_token:e.api.access_token}}:l={processData:o.headers["Content-Type"]&&o.headers["Content-Type"].indexOf("application/json")===0?!1:!0,create:function(e){t.model.notify("call")({req:e,obj:t.obj?t.obj:{}})},complete:function(e){t.model.notify("complete")({req:e,obj:t.obj?t.obj:{}}),r=!1,i()}},typeof e.authCallback!="undefined"&&(l.error401=e.authCallback),l.success=u(o.success),l.error=a(o.error,l.error401),t.model.type==="ajax"?n.ajax(s,n.extend(o,l)):t.model.type==="api"?n.api(s,n.extend(o,l)):t.model.type==="mysql"?n.mysql(s,n.extend(o,l)):!1}}}();return function(o){return function(u){var a=r[o+"/"+u]||r["g/"+u],l=function(n,r,f){var l=i[o+"/"+u]||i["g/"+u],c=new l;c.update(n,r),a.objects[c.get("ref")]=c;if(c.get("id")!==0){a.ids[c.get("id")]=c.get("ref");if(s&&(typeof f=="undefined"||typeof f!="undefined"&&!f)){var h="NODE:"+o+"-"+u+"-id-"+c.get("id");s.set(h,n,e.cacheTimeout,function(r,i){e.env==="Node"&&t.debug.log('ORM: SAVE: store "'+h+'"',"all","log",n)})}}return t.debug.log("model "+o+"/"+u+" : object "+c.get("ref")+" created","all","info"),b("create")(c),c},c=function(n,r){var i=n.id,l=a.objects[n.ref];b("save")(l),f.queue({model:this,obj:l},x(a.req.save,n),{type:a.req.save.method,headers:a.req.save.headers,data:T(a.req.save,n),success:function(f){f=f||{},typeof f=="string"&&(f={status:"SUCCESS",data:{0:{html:f}}});if(f.status==="FAIL")b("alert")({type:"save",alerts:f.alerts?f.alerts:{},obj:l},f);else{if(typeof f.data!="undefined"){for(var c in f.data)break;if(typeof c!="undefined"){if(i===0){a.cache={},l.set("id",c),a.ids[l.get("id")]=l.get("ref");if(s){n.id=c;var h="NODE:"+o+"-"+u+"-id-"+l.get("id");s.set(h,n,e.cacheTimeout,function(r,i){e.env==="Node"&&t.debug.log('ORM: SAVE: store "'+h+'"',"all","log",n)})}}l.update(f.data[c])}}typeof r!="undefined"?r(l,f):b("saved")(l,f)}},error:function(e,t){b("error")({type:"save",errorCode:e,errors:t.errors?t.errors:[],obj:l},t),l.revert()}})},h=function(n,r,i){b("fetch")(n);var c=n.uriParams;f.queue({model:i?i:this},x(a.req.fetch,n),{type:a.req.fetch.method,headers:a.req.fetch.headers,data:T(a.req.fetch,n),success:function(i){if(i&&(!i.status||i.status!=="FAIL")){var f=[],h=[],p;if(typeof a.req.fetch.parser!="undefined")c&&(n.uriParams=c),p=a.req.fetch.parser(i,{},n),i={data:p,count:i&&i.count?i.count:0};else if(a.req.type==="mysql"){var d=0;p={};for(;d<i.length;d++)p[i[d][a.req.dbTable.id]]=i[d];i={data:p}}for(var v in i.data)i.data.hasOwnProperty(v)&&(f.push(v),i.data[v].id=v,h.push(l(i.data[v])));e.env==="Node"&&delete n.access_token,n.uriParams=c;var m=JSON.stringify(n);e.env==="Node"&&t.debug.log("ORM: FETCH "+o+"/"+u+" with cond: "+m,"all","log");if(s){var g="NODE:"+o+"-"+u+"-req-"+m;s.set(g,f,e.cacheTimeout,function(n,r){e.env==="Node"&&t.debug.log('ORM: FETCH: store "'+g+'"',"all","log",f)})}else a.cache[m]=f;if(typeof i!="string")for(var y in i)i.hasOwnProperty(y)&&y!=="status"&&y!=="data"&&y!=="alerts"&&y!=="errors"&&(a.meta[y]=i[y]);typeof r!="undefined"?r(h):b("append")(h)}else n.uriParams=c,b("alert")({type:"fetch",alerts:i&&i.alerts?i.alerts:{},cond:n},i)},error:function(e,t){n.uriParams=c,b("error")({type:"fetch",errorCode:e,errors:t&&t.errors?t.errors:[],cond:n},t)}})},p=function(e,t){if(typeof a.ids[e]=="undefined"){var n=this;h({id:e},t?function(e){t(e[0])}:undefined,n)}else t(a.objects[a.ids[e]])},d=function(e,t){t(a.objects[e]||null)},v=function(e,t){var n=[],r=a.objects,i;for(var s in r)if(r.hasOwnProperty(s)){i=!0;for(var o in e)if(e.hasOwnProperty(o)&&r[s].get(o)!=e[o]){i=!1;break}i&&n.push(r[s])}n.length<=1?t(n[0]||null):t(n)},m=function(n,r){if(n.uriParams){var i=n.uriParams;delete n.uriParams,n.uriParams=i}var f=JSON.stringify(n);e.env==="Node"&&t.debug.log("ORM: SELECT "+o+"/"+u+" with cond: "+f,"all","log");if(s){var l="NODE:"+o+"-"+u+"-req-"+f;s.get(l,function(i,s){e.env==="Node"&&t.debug.log('ORM: SELECT: retrieve "'+l+'"',"all","log",s),g(n,s,r,this)})}else g(n,a.cache[f],r,this)},g=function(n,r,i,f){if(!r)e.env==="Node"&&t.debug.log("ORM: SELECT: data retrieved from server","all","log"),h(n,i?function(e){i(e)}:undefined,f);else{e.env==="Node"&&t.debug.log("ORM: SELECT: data retrieved from cache:","all","log",r);var c=[],p=0,d=r.length,v=[];if(d===0||!s){for(p=0;p<d;p++)c.push(a.objects[a.ids[r[p]]]);i?i(c):b("append")(c)}else{for(p=0;p<d;p++)v.push("NODE:"+o+"-"+u+"-id-"+r[p]);s.get(v,function(e,t){var n=[],r;for(r in t)n.push(l(t[r],!1,!0));i?i(n):b("append")(n)})}}},y=function(n,r,i){var l=a.objects[n];b("delete")(l),typeof r=="undefined"&&(r={id:l.get("id")}),f.queue({model:this},x(a.req.del,r),{type:a.req.del.method,headers:a.req.del.headers,data:T(a.req.del,r),success:function(r){r=r||{};if(r.status==="SUCCESS"||typeof r.status=="undefined"){typeof i!="undefined"?i(l,r):b("deleted")(l,r),delete a.ids[l.get("id")],delete a.objects[n];if(s){var f="NODE:"+o+"-"+u+"-id-"+l.get("id");s.del(f,function(n,r){e.env==="Node"&&t.debug.log('ORM: DEL: delete "'+f+'"',"all","log",r)})}}else b("alert")({type:"delete",alerts:r.alerts?r.alerts:{},obj:l},r)},error:function(e,t){b("error")({type:"delete",errorCode:e,errors:t.errors?t.errors:[],obj:l},t),delete a.ids[l.get("id")],delete a.objects[n]}})},b=function(e){return function(){t.debug.log("model "+o+"/"+u+" : "+e,"all","log",arguments[0]),tetra.controller.modelNotify(u,e,arguments)}},w=function(e,t){b("reset")(a.objects),a.ids={},a.objects={},f.queue({model:this},x(a.req.reset,e),{type:a.req.reset.method,headers:a.req.reset.headers,data:T(a.req.reset,e),success:function(e){e=e||{},e.status&&e.status==="FAIL"?b("alert")({type:"reset",alerts:e.alerts?e.alerts:{}},e):typeof t!="undefined"?t(u,e):b("resetted")(u,e)},error:function(t,n){b("error")({type:"reset",errorCode:t,errors:n.errors?n.errors:[],data:e},n)}})},E=function(){var e=0,t=a.objects;for(var n in t)t.hasOwnProperty(n)&&e++;return e},S=function(e){return a.meta[e]},x=function(e,t,n){var r=e.url,i;if(a.req.type==="mysql")return a.req.dbTable;if(typeof e.uriParams!="undefined"){for(var s=0,o=e.uriParams.length;s<o;s++)typeof t[e.uriParams[s]]!="undefined"?r=r.replace("{"+s+"}",t[e.uriParams[s]]):r=r.replace("{"+s+"}",t.uriParams[e.uriParams[s]]);typeof t.uriParams!="undefined"&&delete t.uriParams}return n||(i=new Date,r.indexOf("?")<0?r+="?ts="+i.getTime():r+="&ts="+i.getTime()),r},T=function(e,t){return e.headers["Content-Type"]&&e.headers["Content-Type"].indexOf("application/json")===0?JSON.stringify(n.extend(t,e.params)):n.extend(t,e.params)};return{type:a.req.type,create:function(e){return l(e,!0)},save:c,fetch:h,find:p,findByRef:d,findByCond:v,select:m,del:y,reset:w,notify:b,length:function(){return E()}(),getMeta:S}}}}),s=function(e,n){return t.orm(e)(n)},s.list=function(){var e=[],n;for(n in r)r.hasOwnProperty(n)&&(t.debug.log(n),e.push(n));return e},s.retrieve=function(e,t){return r[e+"/"+t]},s.man=function(){return t.debug.log("Tetra.js ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),t.debug.log("> Model specs:"),t.debug.log("		- retrieve an object and its ref		> tetra.debug.model(modelName).findByRef(ref)"),t.debug.log("		- notify all controllers as a model		> tetra.debug.model(modelName).notify(type)(data)"),t.debug.log("			  * types : call, complete, create, fetch, append, save, saved, delete, deleted, reset, resetted, error"),t.debug.log("		- list all models						> tetra.debug.model.list()"),t.debug.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),!0};var o=function(e,r){var i=e,s=r.scope,o=r.attr,u=r.methods;return function(){var e=n.extend({ref:0,id:0},o),r={};for(var a in e)e.hasOwnProperty(a)&&(r[a]=e[a]);var f=n.extend({get:function(t){return e[t]},getAll:function(){return e},set:function(t,n){return r[t]=e[t],typeof e[t]!="undefined"&&(e[t]=n),this},update:function(e,t){if(t||c(e,this)){for(var n in e)this.set(n,e[n]);return this}return{save:function(){}}},revert:function(){e=r},save:function(r,o){return c(e,this)?(t.orm(s)(i).save(n.extend(e,r),o),e.id):!1},remove:function(r,o){t.orm(s)(i).del(e.ref,n.extend(e,r),o)}},u(e)),l=function(){e.ref=(new Date).getTime()+"-"+Math.ceil(Math.random()*1001),f.ref=e.ref},c=function(t,n){var r=[];if(typeof f.validate!="undefined"){var s={};for(var o in e)e.hasOwnProperty(o)&&(typeof t[o]!="undefined"?s[o]=t[o]:s[o]=e[o]);r=f.validate(s,r);if(r.length>0)return tetra.controller.modelNotify(i,"invalid",[{attr:r,obj:n}]),!1}return!0};return l(),typeof f.init=="function"&&f.init(),f}},u=function(t,r){typeof r.req=="undefined"&&(r.req={});var i=n.extend({objects:{},ids:{},cache:{},meta:{}},r);typeof i.req.type=="undefined"&&(i.req.type="ajax"),i.req.fetch=n.extend({url:e.FETCH_URL.replace("{name}",t),method:e.FETCH_METHOD,headers:{},params:{}},r.req.fetch),i.req.save=n.extend({url:e.SAVE_URL.replace("{name}",t),method:e.SAVE_METHOD,headers:{},params:{}},r.req.save),i.req.del=n.extend({url:e.DEL_URL.replace("{name}",t),method:e.DEL_METHOD,headers:{},params:{}},r.req.del),i.req.reset=n.extend({url:e.RESET_URL.replace("{name}",t),method:e.RESET_METHOD,headers:{},params:{}},r.req.reset);for(var s in i.req)if(i.req.hasOwnProperty(s)){var o=i.req[s];o.hasOwnProperty("headers")&&(o.headers["Content-type"]&&(o.headers["Content-Type"]=o.headers["Content-type"],delete o.headers["Content-type"]),o.headers["Content-Type"]&&!/charset/.test(o.headers["Content-Type"])&&(o.headers["Content-Type"]=o.headers["Content-Type"]+";charset=utf-8"),o.headers.Accept||(o.headers.Accept="*/*"))}var u=r.req.save.method.toUpperCase();if(u!=="POST"&&u!=="PUT")throw new Error("A 'save' can only be performed using POST or PUT");var a=r.req.del.method.toUpperCase();if(a!=="POST"&&a!=="DELETE")throw new Error("A 'delete' can only be performed using POST or DELETE");var f=r.req.reset.method.toUpperCase();if(f!=="PUT"&&f!=="POST")throw new Error("A 'reset' can only be performed using PUT or POST");return i};return{register:function(n,s){s=s||{},e.env==="Node"&&(s.scope="node"),s.scope||(s.scope="g");var a=s.scope+"/"+n;if(!n)throw new Error("tetra.model.register(name, params) : Name is a required argument");if(r[a]||r["g/"+n])throw new Error("A model with the name "+n+" already exists");t.dep.define(s.scope+"/model/"+n+".class",function(){return r[a]=u(n,s),t.debug.log("model "+a+" : registered","all","info"),i[a]=new o(n,s),t.debug.log("model "+a+" : associated class generated","all","info"),r[a]}),t.dep.require([s.scope+"/model/"+n+".class"])},destroy:function(e,n){n||(n="g");var i=n+"/"+e;t.dep.undef(n+"/model/"+e+".class"),delete r[i]},debug:s}});